{% extends 'base.html' %}

{% block title %}{{ title }} - Minibini{% endblock %}

{% block navigation %}
{% include 'includes/settings_navigation.html' %}
{% endblock %}

{% block content %}
<h2>{{ title }}</h2>

<div style="background-color: #f0f0f0; padding: 10px; margin-bottom: 20px; border-left: 4px solid #007bff;">
    <strong>What is a Bundling Rule?</strong>
    <p>Bundling Rules combine multiple worksheet tasks into a single estimate line item. This is used when you want to show customers a product price rather than itemized components.</p>
    <p><strong>How it works:</strong></p>
    <ol>
        <li>Tasks with Task Mappings set to "bundle" are grouped by their bundle_identifier</li>
        <li>This rule's <code>product_type</code> must match the TaskMapping's <code>default_product_type</code></li>
        <li>The <code>line_item_template</code> becomes the display name (e.g., "Custom Cabinet - cabinet_001")</li>
        <li>The <code>default_units</code> determines quantity: "each" = qty 1, "hours" = sum of task hours</li>
        <li>Component prices are summed based on your pricing settings</li>
    </ol>
</div>

<form method="post">
    {% csrf_token %}
    <table>
        {% for field in form %}
        <tr>
            <th><label for="{{ field.id_for_label }}">{{ field.label }}</label></th>
            <td>
                {{ field }}
                {% if field.help_text %}<br><small>{{ field.help_text }}</small>{% endif %}
                {% if field.errors %}<br><span style="color: red;">{{ field.errors }}</span>{% endif %}
            </td>
        </tr>
        {% endfor %}
    </table>
    <p>
        <button type="submit">{{ submit_label }}</button>
        <a href="{% url 'jobs:bundling_rule_list' %}">Cancel</a>
    </p>
</form>
{% endblock %}
